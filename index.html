<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jessie Math - ä¸‰å¹´ç´šé™¤æ³•å¤§å†’éšª</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-yellow: #FFD700;
            --secondary-blue: #4A90E2;
            --accent-pink: #FF6B6B;
            --bg-color: #f0faff;
            --card-bg: #ffffff;
            --text-dark: #333;
            --success-green: #2ecc71;
        }

        * { box-sizing: border-box; font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif; }
        body { margin: 0; background-color: var(--bg-color); overflow-x: hidden; color: var(--text-dark); }

        /* --- Header & Brand --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .hero-brand { display: flex; align-items: center; }
        .logo-circle {
            width: 50px; height: 50px;
            background: var(--primary-yellow);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            margin-right: 10px;
        }
        .logo-circle img { width: 80%; height: auto; }
        .brand-name { font-weight: bold; font-size: 1.2rem; }

        .nav-links { display: flex; gap: 8px; }
        .nav-btn {
            text-decoration: none;
            color: #555;
            padding: 8px 12px;
            border-radius: 20px;
            background: #eee;
            font-size: 0.85rem;
            display: flex; align-items: center; gap: 5px;
            transition: 0.3s;
        }
        .nav-btn:hover { background: #ddd; }

        /* --- UI Screens --- */
        .screen {
            display: none;
            max-width: 600px;
            margin: 20px auto;
            padding: 25px;
            text-align: center;
            background: var(--card-bg);
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            position: relative;
        }
        .screen.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Components --- */
        .btn-main {
            background: var(--secondary-blue);
            color: white; border: none;
            padding: 15px 45px; border-radius: 50px;
            font-size: 1.2rem; cursor: pointer;
            margin: 15px 0; transition: 0.3s;
            box-shadow: 0 4px 15px rgba(74, 144, 226, 0.3);
        }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4); }

        input[type="text"] {
            padding: 15px; width: 90%; border: 2px solid #eee;
            border-radius: 15px; font-size: 1.1rem; margin-bottom: 20px; outline: none;
        }
        input[type="text"]:focus { border-color: var(--secondary-blue); }

        .level-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .level-card {
            background: #fdfdfd; padding: 20px; border-radius: 18px;
            cursor: pointer; border: 3px solid #f0f0f0;
            transition: 0.3s;
        }
        .level-card:hover { border-color: var(--primary-yellow); transform: scale(1.02); background: #fffdf0; }
        .level-card h4 { margin: 0 0 8px 0; color: var(--secondary-blue); }
        .level-card p { margin: 0; font-size: 0.9rem; color: #777; }

        /* --- æ’è¡Œæ¦œæ¨£å¼ --- */
        .lobby-leaderboard {
            margin-top: 30px;
            background: #fff9e6;
            border-radius: 15px;
            padding: 15px;
            border: 2px solid var(--primary-yellow);
        }
        .board-item {
            display: flex; justify-content: space-between;
            padding: 8px 15px; border-bottom: 1px solid #ffeeba;
        }
        .board-item:last-child { border-bottom: none; }
        .rank-num { font-weight: bold; color: #d4a017; margin-right: 10px; }

        /* --- Game Play --- */
        #game-info {
            display: flex; justify-content: space-around; align-items: center;
            margin-bottom: 20px; font-size: 1.2rem; font-weight: bold;
        }
        .timer { color: var(--accent-pink); background: #fff0f0; padding: 5px 15px; border-radius: 10px; }
        .score-box { color: var(--secondary-blue); }
        
        .combo-badge {
            position: absolute; right: 20px; top: 100px;
            color: #FF8C00; font-size: 1.8rem; font-weight: 900;
            text-shadow: 2px 2px 0px #fff; display: none;
            animation: bounce 0.5s infinite alternate;
        }
        @keyframes bounce { from { transform: translateY(0) scale(1); } to { transform: translateY(-10px) scale(1.1); } }

        .question-card {
            background: #fffef0; padding: 40px 20px; border-radius: 20px;
            border: 3px dashed var(--primary-yellow); margin-bottom: 25px;
            font-size: 1.8rem; line-height: 1.4;
            min-height: 150px; display: flex; align-items: center; justify-content: center;
        }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .opt-btn {
            background: white; border: 2px solid #eee;
            padding: 18px; border-radius: 15px; font-size: 1.3rem; 
            cursor: pointer; transition: 0.2s; box-shadow: 0 3px 0 #eee;
        }
        .opt-btn:hover { background: #f0f7ff; border-color: var(--secondary-blue); }
        .opt-btn:active { transform: translateY(3px); box-shadow: none; }

        /* --- Feedback Overlay --- */
        .feedback-overlay {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; padding: 20px; border-radius: 15px;
            font-size: 1.5rem; font-weight: bold; z-index: 100;
            display: none; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        @keyframes popIn { 
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        .feedback-correct { background: rgba(46, 204, 113, 0.95); color: white; border: 4px solid #fff; }
        .feedback-wrong { background: rgba(231, 76, 60, 0.95); color: white; border: 4px solid #fff; }

        /* --- Overlays --- */
        #pause-mask {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; color: white;
            flex-direction: column; justify-content: center; align-items: center;
        }

        /* RWD */
        @media (max-width: 480px) {
            .screen { margin: 10px; padding: 15px; }
            .level-grid { grid-template-columns: 1fr; }
            .question-card { font-size: 1.4rem; padding: 30px 15px; }
            .brand-name { display: none; }
        }
    </style>
</head>
<body>

    <header>
        <div class="hero-brand">
            <div class="logo-circle">
                <img src="JESSIEMATH-Q.png" alt="Jessie Math" onerror="this.src='https://via.placeholder.com/40/FFD700/000000?text=J'">
            </div>
            <span class="brand-name">Jessie Math</span>
        </div>
        <div class="nav-links">
            <a href="https://jessiemath0703-chu.github.io/website2/" class="nav-btn"><i class="fas fa-home"></i> é¦–é </a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/" class="nav-btn"><i class="fas fa-gamepad"></i> éŠæˆ²å¤§å»³</a>
            <a href="https://jessiemath0703-chu.github.io/Game-Lobby/#g3-u6" class="nav-btn" style="background: var(--primary-yellow); color: #333;">ä¸‰å¹´ç´šé™¤æ³•</a>
        </div>
    </header>

    <div id="screen-login" class="screen active">
        <h2 style="color: var(--secondary-blue);"><i class="fas fa-rocket"></i> é™¤æ³•å†’éšªç‹</h2>
        <p>æ­¡è¿ä¾†åˆ°æ•¸å­¸å†’éšªä¸–ç•Œï¼è«‹è¼¸å…¥åå­—ï¼š</p>
        <input type="text" id="player-name" placeholder="ä¾‹å¦‚ï¼šå°æ˜" maxlength="10">
        <div style="text-align: left; background: #f8f9fa; padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid var(--primary-yellow);">
            <p style="margin-top:0;"><strong>ğŸ“œ å†’éšªè¦å‰‡ï¼š</strong></p>
            <ul style="padding-left: 20px; line-height: 1.6;">
                <li>é™æ™‚ <strong>60 ç§’</strong> éš¨æ©Ÿå‡ºé¡Œã€‚</li>
                <li>ç­”å°ï¼š<strong>+5 ç§’</strong> & ç²å¾—åˆ†æ•¸ã€‚</li>
                <li>ç­”éŒ¯ï¼š<strong>-5 ç§’</strong> (è¦å°å¿ƒå“¦ï¼)ã€‚</li>
                <li><strong>Comboï¼š</strong>é€£çºŒç­”å°åˆ†æ•¸æœƒè¶Šä¾†è¶Šé«˜ï¼</li>
            </ul>
        </div>
        <button class="btn-main" onclick="goToLobby()">é€²å…¥éŠæˆ²å¤§å»³</button>
    </div>

    <div id="screen-lobby" class="screen">
        <h3 id="welcome-msg">æ¢éšªå®¶ï¼Œè«‹é¸æ“‡é—œå¡</h3>
        <div style="margin-bottom: 20px;">
            <label><strong>æŒ‘æˆ°é€Ÿåº¦ï¼š</strong></label>
            <select id="difficulty-select" style="padding: 8px 15px; border-radius: 10px; border: 2px solid #ddd;">
                <option value="1">æ™®é€š (1.0x)</option>
                <option value="1.5">é€²éš (1.5x åˆ†æ•¸)</option>
                <option value="2">å¤§å¸« (2.0x åˆ†æ•¸)</option>
            </select>
        </div>
        <div class="level-grid">
            <div class="level-card" onclick="startGame(1)">
                <h4>Lv.1 é­”æ³•ç”œé»åº—</h4>
                <p>ğŸ­ ç·´ç¿’ã€Œå¹³å‡åˆ†é…ã€</p>
            </div>
            <div class="level-card" onclick="startGame(2)">
                <h4>Lv.2 æ£®æ—æ¬å®¶éšŠ</h4>
                <p>ğŸ“¦ ç·´ç¿’ã€Œåˆ†è£åŒ…å«ã€</p>
            </div>
            <div class="level-card" onclick="startGame(3)">
                <h4>Lv.3 å¯¶è—å®ˆè­·è€…</h4>
                <p>ğŸ’ æŒ‘æˆ°ã€Œé¤˜æ•¸åˆ¤æ–·ã€</p>
            </div>
        </div>
        <div class="lobby-leaderboard">
            <h4>ğŸ† å…¨çƒè‹±é›„æ¦œ (Top 5)</h4>
            <div id="lobby-board-list">
                <p style="color:#999;">å°šç„¡ç´€éŒ„ï¼Œå¿«å»æŒ‘æˆ°å§ï¼</p>
            </div>
        </div>
    </div>

    <div id="screen-game" class="screen">
        <div id="feedback-correct" class="feedback-overlay feedback-correct">âœ¨ å¤ªæ£’äº†ï¼æ­£ç¢ºï¼ âœ¨</div>
        <div id="feedback-wrong" class="feedback-overlay feedback-wrong">âŒ ç­”éŒ¯äº†ï¼<br>æ­£ç¢ºç­”æ¡ˆæ˜¯ <span id="correct-ans-show"></span></div>

        <div id="combo-display" class="combo-badge">Combo x<span id="combo-val">0</span></div>
        <div id="game-info">
            <span class="score-box">å¾—åˆ†: <span id="score-val">0</span></span>
            <span class="timer"><i class="fas fa-clock"></i> <span id="timer-val">60</span>s</span>
        </div>
        <div id="question-container">
            <div class="question-card" id="q-text">æº–å‚™ä¸­...</div>
            <div class="options-grid" id="options-box"></div>
        </div>
        <div style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;">
            <button onclick="pauseGame()" class="nav-btn"><i class="fas fa-pause"></i> æš«åœ</button>
            <button onclick="restartGame()" class="nav-btn"><i class="fas fa-redo"></i> é‡æ–°</button>
            <button onclick="quitGame()" class="nav-btn"><i class="fas fa-sign-out-alt"></i> å›ä¸»é¸å–®</button>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <h2 id="result-title">å†’éšªçµæŸï¼</h2>
        <div id="star-rating" style="font-size: 3.5rem; color: var(--primary-yellow); margin: 10px 0; text-shadow: 2px 2px 5px rgba(0,0,0,0.1);"></div>
        <p style="font-size: 1.2rem;">å†’éšªè€…ï¼š<span id="res-name" style="font-weight:bold;"></span></p>
        <div style="background: #f0f7ff; padding: 20px; border-radius: 20px; margin: 20px 0;">
            <span style="font-size: 1.1rem;">æœ€çµ‚å¾—åˆ†</span><br>
            <span id="res-score" style="font-size: 3rem; font-weight: bold; color: var(--secondary-blue);">0</span>
        </div>
        <button class="btn-main" onclick="showScreen('screen-lobby'); renderBoard();">å†ç©ä¸€æ¬¡</button>
    </div>

    <div id="pause-mask">
        <h1 style="font-size: 3rem; margin-bottom: 20px;">ä¼‘æ¯ä¸€ä¸‹...</h1>
        <button class="btn-main" onclick="resumeGame()" style="background: var(--primary-yellow); color: #333;">ç¹¼çºŒå†’éšª</button>
    </div>

    <script>
        let playerName = "";
        let currentLevel = 1;
        let score = 0;
        let timer = 60;
        let combo = 0;
        let gameActive = false;
        let timerInterval;
        let currentAnswer = 0;
        let difficulty = 1;
        let canClick = true; // é˜²æ­¢é€£çºŒé»æ“Š

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'screen-lobby') renderBoard();
        }

        function goToLobby() {
            const inputName = document.getElementById('player-name').value.trim();
            if(!inputName) { alert("è«‹å…ˆè¼¸å…¥åå­—å–”ï¼"); return; }
            playerName = inputName;
            document.getElementById('welcome-msg').innerText = `ä½ å¥½ï¼Œ${playerName}ï¼é¸æ“‡æŒ‘æˆ°é—œå¡ï¼š`;
            showScreen('screen-lobby');
        }

        function startGame(lv) {
            currentLevel = lv;
            score = 0;
            timer = 60;
            combo = 0;
            difficulty = parseFloat(document.getElementById('difficulty-select').value);
            gameActive = true;
            canClick = true;
            document.getElementById('combo-display').style.display = 'none';
            updateUI();
            showScreen('screen-game');
            nextQuestion();
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameActive) {
                    timer--;
                    document.getElementById('timer-val').innerText = timer;
                    if (timer <= 0) endGame();
                }
            }, 1000);
        }

        function nextQuestion() {
            const qText = document.getElementById('q-text');
            const optBox = document.getElementById('options-box');
            optBox.innerHTML = "";
            canClick = true;

            let a, b, q, r = 0;
            let questionStr = "";

            if (currentLevel === 1) {
                b = Math.floor(Math.random() * 8) + 2; 
                q = Math.floor(Math.random() * 9) + 1;
                a = b * q;
                questionStr = `æœ‰ ${a} å€‹è›‹ç³•ï¼Œå¹³åˆ†çµ¦ ${b} å€‹å°æœ‹å‹ï¼Œæ¯äººåˆ†åˆ°å¹¾å€‹ï¼Ÿ`;
                currentAnswer = q;
            } else if (currentLevel === 2) {
                let type = Math.random();
                if (type < 0.15) {
                    b = Math.floor(Math.random() * 10) + 1;
                    questionStr = `ç±ƒå­è£¡æœ‰ 0 å€‹è˜‹æœï¼Œæ¯ ${b} å€‹è£æˆä¸€è¢‹ï¼Œå¯ä»¥è£æˆå¹¾è¢‹ï¼Ÿ`;
                    currentAnswer = 0;
                } else if (type < 0.3) {
                    a = Math.floor(Math.random() * 12) + 1;
                    questionStr = `æœ‰ ${a} é¡†ç³–æœï¼Œæ¯ 1 é¡†è£æˆä¸€åŒ…ï¼Œå…±å¯ä»¥è£å¹¾åŒ…ï¼Ÿ`;
                    currentAnswer = a;
                } else {
                    b = Math.floor(Math.random() * 7) + 3;
                    q = Math.floor(Math.random() * 9) + 2;
                    a = b * q;
                    questionStr = `æœ‰ ${a} é¡†è‰è“ï¼Œæ¯ ${b} é¡†è£ä¸€ç›’ï¼Œç¸½å…±å¯ä»¥è£å¹¾ç›’ï¼Ÿ`;
                    currentAnswer = q;
                }
            } else {
                b = Math.floor(Math.random() * 6) + 3;
                q = Math.floor(Math.random() * 7) + 2;
                r = Math.floor(Math.random() * (b - 1)) + 1;
                a = b * q + r;
                questionStr = `è¨ˆç®— ${a} Ã· ${b}ï¼Œ<br>æœ€å¾Œçš„ã€Œé¤˜æ•¸ã€æ˜¯å¤šå°‘ï¼Ÿ`;
                currentAnswer = r;
            }

            qText.innerHTML = questionStr;
            let options = generateOptions(currentAnswer);
            options.forEach(opt => {
                let btn = document.createElement('button');
                btn.className = 'opt-btn';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(opt);
                optBox.appendChild(btn);
            });
        }

        function generateOptions(correct) {
            let opts = [correct];
            while (opts.length < 4) {
                let wrong = correct + Math.floor(Math.random() * 6) - 3;
                if (wrong < 0 || opts.includes(wrong)) wrong = Math.floor(Math.random() * 20);
                if (!opts.includes(wrong)) opts.push(wrong);
            }
            return opts.sort(() => Math.random() - 0.5);
        }

        function checkAnswer(picked) {
            if (!gameActive || !canClick) return;
            canClick = false;

            const correctEl = document.getElementById('feedback-correct');
            const wrongEl = document.getElementById('feedback-wrong');
            const correctAnsShow = document.getElementById('correct-ans-show');

            if (picked === currentAnswer) {
                combo++;
                let points = 10 * difficulty * (combo >= 3 ? 1.5 : 1);
                score += Math.round(points);
                timer += 5;
                if (combo >= 3) {
                    document.getElementById('combo-display').style.display = 'block';
                    document.getElementById('combo-val').innerText = combo;
                }
                // ç­”å°å›é¥‹
                correctEl.style.display = 'block';
                setTimeout(() => { correctEl.style.display = 'none'; nextQuestion(); }, 1000);
            } else {
                combo = 0;
                timer -= 5;
                document.getElementById('combo-display').style.display = 'none';
                // ç­”éŒ¯å›é¥‹ä¸¦çµ¦ç­”æ¡ˆ
                correctAnsShow.innerText = currentAnswer;
                wrongEl.style.display = 'block';
                setTimeout(() => { wrongEl.style.display = 'none'; nextQuestion(); }, 1500);
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('score-val').innerText = score;
            document.getElementById('timer-val').innerText = timer;
        }

        function pauseGame() { gameActive = false; document.getElementById('pause-mask').style.display = 'flex'; }
        function resumeGame() { gameActive = true; document.getElementById('pause-mask').style.display = 'none'; }
        function restartGame() { if(confirm("ç¢ºå®šè¦é‡ç©å—ï¼Ÿåˆ†æ•¸æœƒæ­¸é›¶å–”ï¼")) startGame(currentLevel); }
        function quitGame() { clearInterval(timerInterval); gameActive = false; showScreen('screen-lobby'); }

        function endGame() {
            gameActive = false;
            clearInterval(timerInterval);
            showScreen('screen-result');
            document.getElementById('res-name').innerText = playerName;
            document.getElementById('res-score').innerText = score;
            let stars = "â˜…â˜†â˜†";
            if (score > 300) stars = "â˜…â˜…â˜…";
            else if (score > 150) stars = "â˜…â˜…â˜†";
            document.getElementById('star-rating').innerText = stars;
            saveLeaderboard(playerName, score);
        }

        function saveLeaderboard(name, score) {
            let board = JSON.parse(localStorage.getItem('jessie_math_v3') || "[]");
            board.push({name, score, date: new Date().toLocaleDateString()});
            board.sort((a,b) => b.score - a.score);
            localStorage.setItem('jessie_math_v3', JSON.stringify(board.slice(0, 5)));
        }

        function renderBoard() {
            let board = JSON.parse(localStorage.getItem('jessie_math_v3') || "[]");
            let listEl = document.getElementById('lobby-board-list');
            if(board.length === 0) {
                listEl.innerHTML = `<p style="color:#999; margin:10px;">å°šç„¡ç´€éŒ„ï¼Œæˆç‚ºç¬¬ä¸€å€‹å†’éšªç‹å§ï¼</p>`;
                return;
            }
            let html = board.map((item, idx) => `
                <div class="board-item">
                    <span><span class="rank-num">#${idx+1}</span> ${item.name}</span>
                    <span style="font-weight:bold; color:var(--secondary-blue);">${item.score} åˆ†</span>
                </div>
            `).join('');
            listEl.innerHTML = html;
        }

        window.onload = renderBoard;
    </script>
</body>
</html>